<!DOCTYPE html>
<html>
    <head>
        <title>Google CSV to JSON API converter</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script>

            let data = {
                "csv": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRz58LmAPaCFKsMBRKZH30el7acWcSh8M7XROiNtoRfOMMWHb4bt6eQLjf9F8TF3ayV-tD2hIfrZZyJ/pub?gid=0&single=true&output=csv"
            };

            function callUsingQueryParameter() {
                fetch("/api/?csv=" + encodeURIComponent(data.csv))
                .then(response => response.json())
                .then(data => console.log(data));
            }

            function callUsingRequestWithBody() {
                fetch("/api", {
                    method: 'POST',
                    mode: 'cors', 
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data) 
                })
                .then(response => response.json())
                .then(data => console.log(data));
            }

            $(document).ready(function() {
                $('#callWithQueryParameter').click(() => {
                    callUsingQueryParameter();
                });

                $('#requestWithBody').click(() => {
                    callUsingRequestWithBody();
                });

                $('#convertCSV2JSON').click(() => {
                    csv = $('#publishedCSV').val();
                    fetch("/api/?csv=" + encodeURIComponent(csv))
                    .then(response => response.json())
                    .then(data => {
                        $('#output').text(JSON.stringify(data, null, 2));
                    });
                });
            });

        </script>
    </head>
    <body>
        <div>
            <h1>Google CSV to JSON converter</h1>
        </div>
        <div>
            <p>This API converts single Google Sheets published to the web in CSV format to JSON format.</p>
            <p>The API can be used in two ways:</p>
            <ul>
                <li>with query parameter</li>
                <li>request with data in body</li>
            </ul>
        </div>
        <div><h3>Live demo</h3></div>
        <div>
            <input type="text" placeholder="Link of the published CSV from Google Tables" id="publishedCSV" size="125"/>
        </div>
        <div><button id="convertCSV2JSON">Convert</button></div>
        <div><span id="output">JSON will appear here</span></div>
        <div>If you don't have a document yet try it with this one: https://docs.google.com/spreadsheets/d/e/2PACX-1vRz58LmAPaCFKsMBRKZH30el7acWcSh8M7XROiNtoRfOMMWHb4bt6eQLjf9F8TF3ayV-tD2hIfrZZyJ/pub?gid=0&single=true&output=csv</div>
        <div><h3>Examples</h3></div>
        <div>
            &#9658;Call with query parameter (parameter should be encoded with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent" target="_blank" rel="noopener">encodeURIComponent</a>):
        </div>
        <div>
            <pre>
    http://localhost:3000/api/?csv=https%3A%2F%2Fdocs.google.com%2Fspreadsheets%2Fd%2Fe%2F2PACX-1vRz58LmAPaCFKsMBRKZH30el7acWcSh8M7XROiNtoRfOMMWHb4bt6eQLjf9F8TF3ayV-tD2hIfrZZyJ%2Fpub%3Fgid%3D0%26single%3Dtrue%26output%3Dcsv
            </pre>
        </div>
        <div>
            <button id="callWithQueryParameter">Call with query parameter and check the console</button>
        </div>
        <div><br/></div>
        <div>
            &#9658;Request with data in body:
        </div>
        <div>
            <pre>
    let data = {
        "csv": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRz58LmAPaCFKsMBRKZH30el7acWcSh8M7XROiNtoRfOMMWHb4bt6eQLjf9F8TF3ayV-tD2hIfrZZyJ/pub?gid=0&single=true&output=csv"
    };
    
    fetch("http://localhost:3000/api", {
        method: 'POST',
        mode: 'cors', 
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data) 
    })
    .then(response => response.json())
    .then(data => console.log(data));
            </pre>
        </div>
        <div>
            <button id="requestWithBody">Request with body and check the console</button>
        </div>
    </body>
</html>